---
description: 
globs: 
alwaysApply: true
---
# ê¸°ë³¸ í”„ë¡œì íŠ¸ êµ¬ì¡° ê·œì¹™

## ğŸ“ í˜„ì¬ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
# í”„ë¡œì íŠ¸ êµ¬ì¡° ê·œì¹™ (CROSS_PLATFORM_COMPATIBILITY í˜¸í™˜)

## ğŸ“ í‘œì¤€ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
vision_system/
â”œâ”€â”€ domains/                   # ë„ë©”ì¸ë³„ ë…ë¦½ ê°œë°œ
â”‚   â”œâ”€â”€ humanoid/              # ì¸ê°„í˜• ë„ë©”ì¸
â”‚   â”‚   â””â”€â”€ face_recognition/  # ì–¼êµ´ì¸ì‹ ê¸°ëŠ¥
â”‚   â”‚       â”œâ”€â”€ model.py       # ONNX ëª¨ë¸ í´ë˜ìŠ¤
â”‚   â”‚       â”œâ”€â”€ run.py         # ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰
â”‚   â”‚       â””â”€â”€ test_model.py  # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ factory/               # ê³µì¥ ë„ë©”ì¸
â”‚   â”‚   â””â”€â”€ defect_detection/  # ë¶ˆëŸ‰ ê²€ì¶œ ê¸°ëŠ¥
â”‚   â”‚       â”œâ”€â”€ model.py       # ONNX ëª¨ë¸ í´ë˜ìŠ¤
â”‚   â”‚       â”œâ”€â”€ run.py         # ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰
â”‚   â”‚       â””â”€â”€ test_model.py  # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ powerline_inspection/  # í™œì„  ê²€ì‚¬ ë„ë©”ì¸ (í–¥í›„)
â”‚       â””â”€â”€ inspection/        # ê²€ì‚¬ ê¸°ëŠ¥
â”‚           â”œâ”€â”€ model.py
â”‚           â”œâ”€â”€ run.py
â”‚           â””â”€â”€ test_model.py
â”œâ”€â”€ shared/                    # ê³µí†µ ëª¨ë“ˆ
â”‚   â””â”€â”€ vision_core/           # ë¹„ì „ ì•Œê³ ë¦¬ì¦˜ ê³µí†µ ê¸°ëŠ¥ (í–¥í›„ ìƒì„± í•„ìš”)
â”œâ”€â”€ common/                    # ë²”ìš© ìœ í‹¸ë¦¬í‹°
â”œâ”€â”€ config/                    # ì„¤ì • íŒŒì¼ (í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”)
â”œâ”€â”€ models/                    # ëª¨ë¸ ì €ì¥ì†Œ (í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”)
â”‚   â””â”€â”€ weights/               # ëª¨ë¸ ê°€ì¤‘ì¹˜ (.onnx íŒŒì¼)
â”œâ”€â”€ datasets/                  # í•™ìŠµ ë°ì´í„° (í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”)
â”œâ”€â”€ data/                      # ëŸ°íƒ€ì„ ë°ì´í„°
â”‚   â”œâ”€â”€ temp/                  # ì„ì‹œ íŒŒì¼ (ìë™ ì •ë¦¬)
â”‚   â”œâ”€â”€ logs/                  # ë¡œê·¸ íŒŒì¼
â”‚   â”œâ”€â”€ output/                # ê²°ê³¼ë¬¼ ì €ì¥
â”‚   â””â”€â”€ domains/               # ë„ë©”ì¸ë³„ ë°ì´í„° (í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”)
â”‚       â”œâ”€â”€ humanoid/          # ì¸ê°„í˜• ë„ë©”ì¸ ë°ì´í„°
â”‚       â””â”€â”€ factory/           # ê³µì¥ ë„ë©”ì¸ ë°ì´í„°
â”œâ”€â”€ scripts/                   # ê°œë°œ ë„êµ¬ ìŠ¤í¬ë¦½íŠ¸ (í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”)
â””â”€â”€ tests/                     # í…ŒìŠ¤íŠ¸ ì½”ë“œ
```

## ğŸ”— ê³„ì¸µë³„ ì˜ì¡´ì„± ê·œì¹™ (CROSS_PLATFORM_COMPATIBILITY í˜¸í™˜)

### ì˜ì¡´ì„± ë°©í–¥ (ìœ„ì—ì„œ ì•„ë˜ë¡œë§Œ í—ˆìš©)
```
Level 4: domains/              # ë„ë©”ì¸ ê³„ì¸µ
    â†“
Level 3: models/               # ëª¨ë¸ ê³„ì¸µ
    â†“
Level 2: shared/               # ê³µìœ  ëª¨ë“ˆ ê³„ì¸µ
    â†“
Level 1: common/, config/      # ê¸°ë°˜ ê³„ì¸µ
```

### ê¸ˆì§€ ì‚¬í•­
```python
# âŒ ì ˆëŒ€ ê¸ˆì§€: ë„ë©”ì¸ ê°„ ì§ì ‘ import
from domains.humanoid.face_recognition import something
# ë‹¤ë¥¸ ë„ë©”ì¸ì—ì„œ ì‚¬ìš© ì‹œ

# âŒ ì ˆëŒ€ ê¸ˆì§€: í•˜ìœ„ ê³„ì¸µì—ì„œ ìƒìœ„ ê³„ì¸µ import
from domains.humanoid.face_recognition import something
# common/ í´ë”ì—ì„œ ì‚¬ìš© ì‹œ

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•: ê³µìœ  ëª¨ë“ˆì„ í†µí•œ í†µì‹ 
from shared.vision_core.detection import FaceDetector
```

## ğŸ“‚ ë„ë©”ì¸ êµ¬ì¡° (CROSS_PLATFORM_COMPATIBILITY í˜¸í™˜)

### í‘œì¤€ ë„ë©”ì¸ ê¸°ëŠ¥ êµ¬ì¡° (í˜„ì¬ êµ¬ì¡° ë°˜ì˜)
```
domains/{domain_category}/{feature_name}/
â”œâ”€â”€ model.py        # ONNX ëª¨ë¸ ë¡œë”© ë° ì¶”ë¡  ì²˜ë¦¬ í´ë˜ìŠ¤
â”œâ”€â”€ run.py          # USB ì¹´ë©”ë¼ ë˜ëŠ” ì´ë¯¸ì§€ íŒŒì¼ì„ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰
â””â”€â”€ test_model.py   # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ìš© ì˜ˆì œ ì´ë¯¸ì§€ ì¶”ë¡  ì½”ë“œ
```

### ë„ë©”ì¸ ì¹´í…Œê³ ë¦¬ë³„ êµ¬ì¡°
```python
DOMAIN_CATEGORIES = {
    'humanoid': {
        'description': 'ì¸ê°„í˜• ê´€ë ¨ ë„ë©”ì¸',
        'features': [
            'face_recognition',    # ì–¼êµ´ì¸ì‹
            'emotion_detection',   # ê°ì • ê²€ì¶œ (í–¥í›„)
            'pose_estimation'      # ìì„¸ ì¶”ì • (í–¥í›„)
        ]
    },
    'factory': {
        'description': 'ê³µì¥ ê´€ë ¨ ë„ë©”ì¸',
        'features': [
            'defect_detection',    # ë¶ˆëŸ‰ ê²€ì¶œ
            'quality_assessment',  # í’ˆì§ˆ í‰ê°€ (í–¥í›„)
            'inventory_tracking'   # ì¬ê³  ì¶”ì  (í–¥í›„)
        ]
    },
    'powerline_inspection': {
        'description': 'í™œì„  ê²€ì‚¬ ë„ë©”ì¸',
        'features': [
            'inspection',          # ê²€ì‚¬
            'defect_detection',    # ê²°í•¨ ê²€ì¶œ (í–¥í›„)
            'thermal_analysis'     # ì—´í™”ìƒ ë¶„ì„ (í–¥í›„)
        ]
    }
}
```

### ê³ ê¸‰ ë„ë©”ì¸ êµ¬ì¡° (ì„ íƒì , ê³ ê¸‰ ê¸°ëŠ¥ìš©)
```
domains/{domain_category}/advanced/
â”œâ”€â”€ core/                      # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (DDD íŒ¨í„´)
â”‚   â”œâ”€â”€ entities/              # ì—”í‹°í‹°
â”‚   â”œâ”€â”€ services/              # ë„ë©”ì¸ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ repositories/          # ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤
â”‚   â””â”€â”€ value_objects/         # ê°’ ê°ì²´
â”œâ”€â”€ infrastructure/            # ì¸í”„ë¼ êµ¬í˜„
â”‚   â”œâ”€â”€ models/                # AI ëª¨ë¸ êµ¬í˜„
â”‚   â”œâ”€â”€ storage/               # ì €ì¥ì†Œ êµ¬í˜„
â”‚   â””â”€â”€ detection_engines/     # ê²€ì¶œ ì—”ì§„
â”œâ”€â”€ interfaces/                # ì™¸ë¶€ ì¸í„°í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ api/                   # REST API
â”‚   â””â”€â”€ cli/                   # CLI ì¸í„°í˜ì´ìŠ¤
â””â”€â”€ runners/                   # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
    â”œâ”€â”€ recognition/           # ì¸ì‹ ê´€ë ¨
    â”œâ”€â”€ data_collection/       # ë°ì´í„° ìˆ˜ì§‘
    â””â”€â”€ demos/                 # ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸
```

## ğŸ—‚ï¸ íŒŒì¼ ì €ì¥ ìœ„ì¹˜ ê·œì¹™

### ë°ì´í„° íŒŒì¼ ìœ„ì¹˜
```python
DATA_LOCATIONS = {
    'ëŸ°íƒ€ì„ ì„ì‹œ ë°ì´í„°': 'data/temp/',
    'ë¡œê·¸ íŒŒì¼': 'data/logs/',
    'ì²˜ë¦¬ ê²°ê³¼': 'data/output/',
    'ë„ë©”ì¸ ë°ì´í„°': 'data/domains/{domain_category}/',
    'í•™ìŠµ ë°ì´í„°': 'datasets/{domain_category}/',
    'ëª¨ë¸ ê°€ì¤‘ì¹˜': 'models/weights/',  # .onnx íŒŒì¼ë§Œ ì €ì¥
    'ì„¤ì • íŒŒì¼': 'config/'
}
```

### ê¸ˆì§€ ìœ„ì¹˜
```python
# âŒ ì ˆëŒ€ ê¸ˆì§€: ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ì„ì‹œ íŒŒì¼ ìƒì„±
FORBIDDEN_ROOT_FILES = [
    "*.log",           # ë¡œê·¸ íŒŒì¼
    "*.tmp",           # ì„ì‹œ íŒŒì¼
    "output_*",        # ê²°ê³¼ë¬¼
    "temp_*",          # ì„ì‹œ íŒŒì¼
    "debug_*",         # ë””ë²„ê·¸ íŒŒì¼
]
```

## ğŸ“ íŒŒì¼ ë„¤ì´ë° ê·œì¹™ (CROSS_PLATFORM_COMPATIBILITY í˜¸í™˜)

### ë„ë©”ì¸ ê¸°ëŠ¥ ë‚´ íŒŒì¼ ë„¤ì´ë°
```python
# í•„ìˆ˜ íŒŒì¼ (CROSS_PLATFORM_COMPATIBILITY ê·œì¹™)
model.py              # ONNX ëª¨ë¸ í´ë˜ìŠ¤
run.py                # ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰
test_model.py         # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

# ì„ íƒì  íŒŒì¼
config.yaml           # ë„ë©”ì¸ë³„ ì„¤ì •
README.md             # ê¸°ëŠ¥ ì„¤ëª…
requirements.txt      # ì˜ì¡´ì„± (í•„ìš”ì‹œ)
```

### ëª¨ë¸ ê°€ì¤‘ì¹˜ ë„¤ì´ë° (CROSS_PLATFORM_COMPATIBILITY í˜¸í™˜)
```python
# íŒ¨í„´: {task}_{architecture}_{dataset}_{date}.onnx
# í•™ìŠµì€ PyTorch (.pt), ì¶”ë¡ ì€ ONNX (.onnx) í•„ìˆ˜
face_recognition_arcface_glint360k_20250628.onnx
defect_detection_yolov8n_factory_20250628.onnx
powerline_inspection_efficientdet_d1_20250628.onnx
```

## ğŸ”§ í•„ìˆ˜ í´ë” ë° íŒŒì¼

### ëª¨ë“  Python íŒ¨í‚¤ì§€ í´ë”
```
required_files = [
    '__init__.py',     # í•„ìˆ˜
    'README.md'        # ê¶Œì¥
]
```

### ë„ë©”ì¸ ê¸°ëŠ¥ í´ë” í•„ìˆ˜ êµ¬ì¡° (CROSS_PLATFORM_COMPATIBILITY)
```
domains/{domain_category}/{feature_name}/
â”œâ”€â”€ __init__.py           # í•„ìˆ˜
â”œâ”€â”€ model.py              # í•„ìˆ˜ (ONNX ëª¨ë¸ í´ë˜ìŠ¤)
â”œâ”€â”€ run.py                # í•„ìˆ˜ (ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰)
â”œâ”€â”€ test_model.py         # í•„ìˆ˜ (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
â””â”€â”€ README.md             # ê¶Œì¥
```

## ğŸ“Š í´ë” ìš©ë„ ëª…í™•í™”

### datasets/ vs data/ êµ¬ë¶„
```python
# datasets/ - í•™ìŠµ ì „ìš© (ê³ ì • ë°ì´í„°) - í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”
datasets/humanoid/
â”œâ”€â”€ raw/                  # ì›ë³¸ í•™ìŠµ ë°ì´í„°
â”œâ”€â”€ processed/            # ì „ì²˜ë¦¬ëœ ë°ì´í„°
â”œâ”€â”€ annotations/          # ë¼ë²¨ë§ ë°ì´í„°
â””â”€â”€ splits/               # train/val/test ë¶„í• 

datasets/factory/
â”œâ”€â”€ raw/                  # ì›ë³¸ í•™ìŠµ ë°ì´í„°
â”œâ”€â”€ processed/            # ì „ì²˜ë¦¬ëœ ë°ì´í„°
â”œâ”€â”€ annotations/          # ë¼ë²¨ë§ ë°ì´í„°
â””â”€â”€ splits/               # train/val/test ë¶„í• 

# data/ - ëŸ°íƒ€ì„ ì „ìš© (ë™ì  ë°ì´í„°)
data/
â”œâ”€â”€ temp/                 # ì„ì‹œ íŒŒì¼ (ìë™ ì •ë¦¬)
â”œâ”€â”€ logs/                 # ë¡œê·¸ íŒŒì¼
â”œâ”€â”€ output/               # ê²°ê³¼ë¬¼
â””â”€â”€ domains/              # ë„ë©”ì¸ë³„ ë°ì´í„° - í˜„ì¬ ëˆ„ë½, ìƒì„± í•„ìš”
    â”œâ”€â”€ humanoid/         # ì¸ê°„í˜• ë„ë©”ì¸ ë°ì´í„°
    â””â”€â”€ factory/          # ê³µì¥ ë„ë©”ì¸ ë°ì´í„°
```

## ğŸš« êµ¬ì¡° ìœ„ë°˜ ì‚¬ë¡€

### 1. ì˜ì¡´ì„± ìˆœí™˜
```python
# âŒ ê¸ˆì§€: ìˆœí™˜ ì˜ì¡´ì„±
# common/utils.py
from domains.humanoid.face_recognition.model import FaceRecognitionModel

# domains/humanoid/face_recognition/model.py  
from common.utils import some_function
```

### 2. ì˜ëª»ëœ íŒŒì¼ ìœ„ì¹˜
```python
# âŒ ê¸ˆì§€: ì„ì‹œ íŒŒì¼ì„ ì˜ëª»ëœ ìœ„ì¹˜ì— ì €ì¥
output_file = "captured_frame.jpg"  # ë£¨íŠ¸ì— ì €ì¥

# âœ… ì˜¬ë°”ë¥¸ ìœ„ì¹˜
output_file = "data/output/captured_frame.jpg"
```

### 3. CROSS_PLATFORM_COMPATIBILITY ìœ„ë°˜
```python
# âŒ ê¸ˆì§€: í•˜ë“œì½”ë”©ëœ ê²½ë¡œ
model_path = "C:\\models\\face_detection.onnx"

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
from pathlib import Path
project_root = Path(__file__).parent.parent.parent
model_path = project_root / "models" / "weights" / "face_detection.onnx"
```

## ğŸ”„ CROSS_PLATFORM_COMPATIBILITY í†µí•© ê·œì¹™

### ê²½ë¡œ ì²˜ë¦¬ (ëª¨ë“  íŒŒì¼ì—ì„œ í•„ìˆ˜)
```python
# âœ… í•„ìˆ˜: pathlib.Path ì‚¬ìš©
from pathlib import Path

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œ ê³„ì‚°
project_root = Path(__file__).parent.parent.parent

# ëª¨ë¸ ê²½ë¡œ
model_path = project_root / "models" / "weights" / "face_detection.onnx"

# ì„¤ì • ê²½ë¡œ
config_path = project_root / "config" / "face_recognition.yaml"

# ë°ì´í„° ê²½ë¡œ
data_path = project_root / "data" / "output"
```

### í•˜ë“œì›¨ì–´ í™˜ê²½ ìë™ ê°ì§€ (ëª¨ë“  run.pyì—ì„œ í•„ìˆ˜)
```python
def get_optimal_config():
    """í•˜ë“œì›¨ì–´ í™˜ê²½ì— ë”°ë¥¸ ìµœì  ì„¤ì • ìë™ ì„ íƒ"""
    import platform, psutil
    system = platform.system().lower()
    cpu_count = psutil.cpu_count()
    memory_gb = psutil.virtual_memory().total // (1024**3)
    
    try:
        import torch
        gpu_available = torch.cuda.is_available()
        gpu_memory = torch.cuda.get_device_properties(0).total_memory // (1024**3) if gpu_available else 0
    except:
        gpu_available = False
        gpu_memory = 0
    
    if gpu_available and gpu_memory >= 16:
        return {"device": "cuda", "batch_size": 16, "model_size": "large", "precision": "fp16"}
    elif gpu_available and gpu_memory >= 4:
        return {"device": "cuda", "batch_size": 4, "model_size": "medium", "precision": "fp16"}
    else:
        return {"device": "cpu", "batch_size": 1, "model_size": "small", "precision": "fp32"}
```

## ğŸ“‹ ëˆ„ë½ëœ í´ë” ìƒì„± ê°€ì´ë“œ

### í˜„ì¬ ëˆ„ë½ëœ í´ë”ë“¤ (ìƒì„± í•„ìš”)
```python
MISSING_FOLDERS = {
    'config/': {
        'purpose': 'ì„¤ì • íŒŒì¼ ì €ì¥',
        'files': ['__init__.py', 'face_recognition.yaml', 'defect_detection.yaml']
    },
    'models/': {
        'purpose': 'ëª¨ë¸ ì €ì¥ì†Œ',
        'subfolders': ['weights/']  # .onnx íŒŒì¼ ì €ì¥
    },
    'datasets/': {
        'purpose': 'í•™ìŠµ ë°ì´í„° ì €ì¥',
        'subfolders': ['humanoid/', 'factory/']
    },
    'scripts/': {
        'purpose': 'ê°œë°œ ë„êµ¬ ìŠ¤í¬ë¦½íŠ¸',
        'files': ['setup_coding_tools.py', 'validate_rules.py']
    },
    'data/domains/': {
        'purpose': 'ë„ë©”ì¸ë³„ ëŸ°íƒ€ì„ ë°ì´í„°',
        'subfolders': ['humanoid/', 'factory/']
    },
    'shared/vision_core/': {
        'purpose': 'ë¹„ì „ ì•Œê³ ë¦¬ì¦˜ ê³µí†µ ê¸°ëŠ¥',
        'subfolders': ['detection/', 'recognition/', 'preprocessing/']
    }
}
```

### í´ë” ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ
```python
def create_missing_folders():
    """ëˆ„ë½ëœ í´ë”ë“¤ ìƒì„±"""
    from pathlib import Path
    
    missing_structure = {
        'config': ['__init__.py'],
        'models/weights': ['__init__.py'],
        'datasets/humanoid': ['__init__.py'],
        'datasets/factory': ['__init__.py'],
        'scripts': ['__init__.py'],
        'data/domains/humanoid': ['__init__.py'],
        'data/domains/factory': ['__init__.py'],
        'shared/vision_core/detection': ['__init__.py'],
        'shared/vision_core/recognition': ['__init__.py'],
        'shared/vision_core/preprocessing': ['__init__.py']
    }
    
    for folder_path, files in missing_structure.items():
        folder = Path(folder_path)
        folder.mkdir(parents=True, exist_ok=True)
        
        for file in files:
            file_path = folder / file
            if not file_path.exists():
                file_path.touch()
                print(f"Created: {file_path}")
``` 