---
description: 
globs: 
alwaysApply: false
---
# ê¸°ë³¸ Python ê°œë°œ í‘œì¤€

## ğŸ“ íŒŒì¼ í—¤ë” (ëª¨ë“  .py íŒŒì¼ í•„ìˆ˜)

```python
# ê¸°ë³¸ Python ê°œë°œ í‘œì¤€

## ğŸ“ íŒŒì¼ í—¤ë” (ëª¨ë“  .py íŒŒì¼ í•„ìˆ˜)

```python
# ê¸°ë³¸ Python ê°œë°œ í‘œì¤€

## ğŸ“ íŒŒì¼ í—¤ë” (ëª¨ë“  .py íŒŒì¼ í•„ìˆ˜)

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
ëª¨ë“ˆ ì„¤ëª….

ì´ ëª¨ë“ˆì€ [ê¸°ëŠ¥ ì„¤ëª…]ì„ ì œê³µí•©ë‹ˆë‹¤.

Example:
    ê¸°ë³¸ì ì¸ ì‚¬ìš© ì˜ˆì‹œë¥¼ ì—¬ê¸°ì— ì‘ì„±í•©ë‹ˆë‹¤.
    
    $ python run_main_process.py --input data.csv
"""

import os
import sys
import logging
from typing import Dict, List, Optional, Tuple, Union
```

## ğŸ“¦ Import ìˆœì„œ (ì‹¤ìš©ì  ê·œì¹™)

### ê¸°ë³¸ Import ìˆœì„œ
```python
# 1. í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ (alphabetical order)
import os
import sys
import time
from pathlib import Path
from typing import Dict, List, Optional, Tuple, Union

# 2. ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ (alphabetical order)
import cv2
import numpy as np
import torch
import yaml

# 3. ë¡œì»¬ ì• í”Œë¦¬ì¼€ì´ì…˜ (project imports)
from common.logging import get_logger
from common.config import load_config
from shared.vision_core.detection import BaseDetector

# 4. ìƒëŒ€ import (ê°™ì€ í´ë” ë‚´)
from .utils import preprocess_data
from .models import DataModel
```

### Import ê·¸ë£¹ êµ¬ë¶„ì ì‚¬ìš©
```python
# í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
import os
import sys
import time
from pathlib import Path
from typing import Dict, List, Optional, Tuple, Union

# ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
import cv2
import numpy as np
import torch
import yaml

# í”„ë¡œì íŠ¸ ëª¨ë“ˆ
from common.logging import get_logger
from common.config import load_config

# ìƒëŒ€ import
from .utils import preprocess_data
```

### ìë™ ì •ë ¬ ë„êµ¬ ì„¤ì •
```python
# .isort.cfg ë˜ëŠ” pyproject.toml ì„¤ì •
[tool.isort]
profile = "black"
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
line_length = 88
sections = ["FUTURE", "STDLIB", "THIRDPARTY", "FIRSTPARTY", "LOCALFOLDER"]
known_first_party = ["common", "shared", "domains"]
```

## ğŸ Python ì½”ë”© í‘œì¤€

### Type Hints ì‚¬ìš©
```python
def process_face_detection(
    image: np.ndarray,
    confidence_threshold: float = 0.5,
    output_path: Optional[str] = None
) -> Tuple[bool, List[Dict]]:
    """ì–¼êµ´ ê²€ì¶œ ì²˜ë¦¬ í•¨ìˆ˜"""
    pass
```

### Docstring ì‘ì„± (Google Style)
```python
def detect_faces(image: np.ndarray, config: Dict) -> List[Dict]:
    """ì´ë¯¸ì§€ì—ì„œ ì–¼êµ´ì„ ê²€ì¶œí•©ë‹ˆë‹¤.
    
    Args:
        image: ì…ë ¥ ì´ë¯¸ì§€ (numpy ë°°ì—´)
        config: ê²€ì¶œ ì„¤ì • ë”•ì…”ë„ˆë¦¬
        
    Returns:
        ê²€ì¶œëœ ì–¼êµ´ ì •ë³´ ë¦¬ìŠ¤íŠ¸
        
    Raises:
        ValueError: ì…ë ¥ ì´ë¯¸ì§€ê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš°
        
    Example:
        >>> image = cv2.imread('face.jpg')
        >>> config = {'confidence': 0.5}
        >>> faces = detect_faces(image, config)
    """
    pass
```

### ë¡œê¹… ì‚¬ìš©
```python
import logging
logger = logging.getLogger(__name__)

def safe_process():
    """ì•ˆì „í•œ í•¨ìˆ˜ ì‹¤í–‰ íŒ¨í„´"""
    try:
        # ë©”ì¸ ë¡œì§
        result = process_data()
        logger.info("Processing completed successfully")
        return result
    except Exception as e:
        logger.error(f"Error in {__name__}: {str(e)}")
        raise
```

## ğŸ“‚ íŒŒì¼ ë„¤ì´ë° ê·œì¹™

### Python íŒŒì¼ ë„¤ì´ë°
- **ì‹¤í–‰ íŒŒì¼**: `run_*.py` (ì˜ˆ: `run_face_recognition.py`)
- **í…ŒìŠ¤íŠ¸ íŒŒì¼**: `test_*.py` (ì˜ˆ: `test_face_detection.py`)
- **ì„œë¹„ìŠ¤ íŒŒì¼**: `*_service.py` (ì˜ˆ: `face_detection_service.py`)
- **ëª¨ë¸ íŒŒì¼**: `*_model.py` (ì˜ˆ: `retinaface_model.py`)

### ë³€ìˆ˜ ë° í•¨ìˆ˜ ë„¤ì´ë°
- **ë³€ìˆ˜/í•¨ìˆ˜**: snake_case (ì˜ˆ: `detect_faces`, `confidence_score`)
- **í´ë˜ìŠ¤**: PascalCase (ì˜ˆ: `FaceDetector`, `PersonRepository`)
- **ìƒìˆ˜**: UPPER_SNAKE_CASE (ì˜ˆ: `DEFAULT_CONFIDENCE`, `MAX_FACES`)

## âš ï¸ ê¸ˆì§€ ì‚¬í•­

1. **ì ˆëŒ€ ê¸ˆì§€**: í•˜ë“œì½”ë”©ëœ ê²½ë¡œ ì‚¬ìš©
   ```python
   # âŒ ê¸ˆì§€
   image_path = "C:/Users/user/images/face.jpg"
   
   # âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
   image_path = config.get('image_path', 'data/images/face.jpg')
   ```

2. **ì ˆëŒ€ ê¸ˆì§€**: ì˜ˆì™¸ ì²˜ë¦¬ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ ì‚¬ìš©
   ```python
   # âŒ ê¸ˆì§€
   cap = cv2.VideoCapture(0)
   frame = cap.read()
   
   # âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
   try:
       cap = cv2.VideoCapture(0)
       ret, frame = cap.read()
       if not ret:
           raise ValueError("Failed to read frame")
   finally:
       cap.release()
   ```

3. **ì ˆëŒ€ ê¸ˆì§€**: print() ë¬¸ ì‚¬ìš© (ë¡œê¹… ì‚¬ìš©)
   ```python
   # âŒ ê¸ˆì§€
   print(f"Face detected: {face_count}")
   
   # âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
   logger.info(f"Face detected: {face_count}")
   ```

## ğŸ”§ ì½”ë“œ í’ˆì§ˆ ë„êµ¬ (ì„ íƒì )

### ê¸°ë³¸ ë„êµ¬
- **black**: ì½”ë“œ í¬ë§·íŒ…
- **isort**: import ì •ë ¬
- **flake8**: ê¸°ë³¸ ë¦°íŒ…

### ì‚¬ìš©ë²•
```bash
# ì½”ë“œ ìë™ í¬ë§·íŒ…
black .

# import ë¬¸ ì •ë ¬
isort .

# ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
flake8 .
```

---

**ì ìš© ìš°ì„ ìˆœìœ„**: 
1. íŒŒì¼ í—¤ë” + Docstring (í•„ìˆ˜)
2. Type Hints (ê¶Œì¥)
3. ë¡œê¹… ì‹œìŠ¤í…œ (í•„ìˆ˜)
4. ì½”ë“œ í’ˆì§ˆ ë„êµ¬ (ì„ íƒì ) 

## âš ï¸ í˜„ì‹¤ì  í•œê³„ ë° ì ìš© ì•ˆë‚´
- **Import ìˆœì„œ**: isortë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ ì •ë ¬ ê¶Œì¥ (ìˆ˜ë™ ì •ë ¬ë„ í—ˆìš©)
- **Type Hints**: ëª¨ë“  í•¨ìˆ˜ì— í•„ìˆ˜ì´ì§€ë§Œ, ë³µì¡í•œ íƒ€ì…ì€ ì„ íƒì 
- **Docstring**: Google Style í•„ìˆ˜ì´ì§€ë§Œ, ê°„ë‹¨í•œ í•¨ìˆ˜ëŠ” í•œ ì¤„ ì„¤ëª… í—ˆìš©
- **í…ŒìŠ¤íŠ¸**: pytest ì‚¬ìš© ê¶Œì¥, ì»¤ë²„ë¦¬ì§€ëŠ” 70% ì´ìƒ ëª©í‘œ

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë° ìë™í™” (ê¸°ë³¸)

### pytest ê¸°ë³¸ ì„¤ì •
```python
# tests/test_example.py
import pytest
from unittest.mock import Mock, patch

def test_basic_function():
    """ê¸°ë³¸ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸"""
    result = process_data([{'id': 1}], {'mode': 'test'})
    assert result[0] is True  # ì„±ê³µ ì—¬ë¶€
    assert 'success' in result[1]  # ë©”ì‹œì§€ í™•ì¸

@pytest.fixture
def sample_data():
    """í…ŒìŠ¤íŠ¸ìš© ìƒ˜í”Œ ë°ì´í„°"""
    return [{'id': 1, 'value': 'test'}]

def test_with_fixture(sample_data):
    """í”½ìŠ¤ì²˜ë¥¼ ì‚¬ìš©í•œ í…ŒìŠ¤íŠ¸"""
    result = process_data(sample_data, {})
    assert result[0] is True
```

### ì½”ë“œ í’ˆì§ˆ ë„êµ¬ ì„¤ì •
```python
# pyproject.tomlì— ì¶”ê°€
[tool.black]
line-length = 88
target-version = ['py38']

[tool.isort]
profile = "black"
line_length = 88

[tool.flake8]
max-line-length = 88
extend-ignore = ["E203", "W503"]

[tool.mypy]
python_version = "3.8"
warn_return_any = true
disallow_untyped_defs = true
```

### pre-commit ì„¤ì • (ì„ íƒì )
```yaml
# .pre-commit-config.yaml
repos:
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3
  
  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
  
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
```

## ğŸš« ê¸ˆì§€ ì‚¬í•­
```python
# âŒ ê¸ˆì§€: í•œê¸€ ë³€ìˆ˜ëª…
ì‚¬ìš©ì_ì´ë¦„ = "í™ê¸¸ë™"  # ê¸ˆì§€

# âŒ ê¸ˆì§€: ë„ˆë¬´ ì§§ì€ ë³€ìˆ˜ëª…
a = 1  # ê¸ˆì§€
x = "test"  # ê¸ˆì§€

# âŒ ê¸ˆì§€: ë§¤ì§ ë„˜ë²„
if count > 10:  # ê¸ˆì§€
    pass

# âœ… ê¶Œì¥: ìƒìˆ˜ ì‚¬ìš©
MAX_RETRY_COUNT = 10
if count > MAX_RETRY_COUNT:
    pass
```

## ğŸ”§ ì‹¤ì œ ì ìš© ì˜ˆì‹œ

### ë°ëª¨ ì½”ë“œì—ì„œì˜ ì ìš©
```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
ì‹¤ì‹œê°„ ì–¼êµ´ì¸ì‹ ë°ëª¨.

ì›¹ìº ì„ í†µí•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ì–¼êµ´ì„ ê²€ì¶œí•˜ê³  ì¸ì‹í•˜ëŠ” ë°ëª¨ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.
"""

# í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
import argparse
import time
from pathlib import Path
from typing import List, Optional

# ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬
import cv2
import numpy as np

# í”„ë¡œì íŠ¸ ëª¨ë“ˆ
from common.logging import get_logger
from domains.face_recognition.core.services import FaceDetectionService

logger = get_logger(__name__)


class FaceDetectionDemo:
    """ì–¼êµ´ ê²€ì¶œ ë°ëª¨ í´ë˜ìŠ¤"""
    
    def __init__(self, camera_id: int = 0) -> None:
        """ë°ëª¨ ì´ˆê¸°í™”.
        
        Args:
            camera_id: ì¹´ë©”ë¼ ID (ê¸°ë³¸ê°’: 0)
        """
        self.camera_id = camera_id
        self.detection_service = FaceDetectionService()
        self.is_running = False
    
    def run(self) -> bool:
        """ë°ëª¨ ì‹¤í–‰.
        
        Returns:
            bool: ì‹¤í–‰ ì„±ê³µ ì—¬ë¶€
        """
        try:
            self.is_running = True
            logger.info("Face detection demo started")
            
            # ë©”ì¸ ì²˜ë¦¬ ë£¨í”„
            while self.is_running:
                # í”„ë ˆì„ ì²˜ë¦¬ ë¡œì§
                pass
                
            return True
            
        except Exception as e:
            logger.error(f"Demo error: {str(e)}")
            return False
        finally:
            self.is_running = False
            logger.info("Face detection demo finished")


def main() -> int:
    """ë©”ì¸ í•¨ìˆ˜.
    
    Returns:
        int: ì¢…ë£Œ ì½”ë“œ (0: ì„±ê³µ, 1: ì‹¤íŒ¨)
    """
    parser = argparse.ArgumentParser(description="ì–¼êµ´ ê²€ì¶œ ë°ëª¨")
    parser.add_argument("--camera", type=int, default=0, help="ì¹´ë©”ë¼ ID")
    args = parser.parse_args()
    
    demo = FaceDetectionDemo(camera_id=args.camera)
    success = demo.run()
    
    return 0 if success else 1


if __name__ == "__main__":
    exit(main())
```

## ğŸ“‹ Python í‘œì¤€ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í•„ìˆ˜ ì¤€ìˆ˜ í•­ëª©
- [ ] íŒŒì¼ í—¤ë” (shebang, encoding, docstring)
- [ ] Import ìˆœì„œ (í‘œì¤€ â†’ ì„œë“œíŒŒí‹° â†’ í”„ë¡œì íŠ¸ â†’ ìƒëŒ€)
- [ ] Type Hints (ëª¨ë“  í•¨ìˆ˜ ë§¤ê°œë³€ìˆ˜, ë°˜í™˜ê°’)
- [ ] Docstring (Google Style)
- [ ] ë³€ìˆ˜/í•¨ìˆ˜ ë„¤ì´ë° (snake_case)
- [ ] í´ë˜ìŠ¤ ë„¤ì´ë° (PascalCase)
- [ ] ìƒìˆ˜ ë„¤ì´ë° (UPPER_SNAKE_CASE)
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ ë° ë¡œê¹…

### ê¶Œì¥ ì¤€ìˆ˜ í•­ëª©
- [ ] pytest í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] black ì½”ë“œ í¬ë§·íŒ…
- [ ] isort import ì •ë ¬
- [ ] flake8 ë¦°íŒ…
- [ ] mypy íƒ€ì… ì²´í‚¹

### ì„ íƒì  ì¤€ìˆ˜ í•­ëª©
- [ ] pre-commit í›… ì„¤ì •
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 80% ì´ìƒ
- [ ] ë³µì¡í•œ íƒ€ì… íŒíŠ¸ (Union, Generic ë“±)
- [ ] ê³ ê¸‰ ì˜ˆì™¸ ì²˜ë¦¬ (ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤) 